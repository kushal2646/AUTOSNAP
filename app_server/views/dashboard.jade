extends layout

block content
  // Header and Greeting
  .container-fluid.py-4
    h1.display-4.text-primary Dashboard
    p.lead.text-muted Welcome back! Here you can manage your appointments and track your vehicle's maintenance.

  // Main Content Grid (Appointments & Maintenance in a two-column layout)
  .row.g-4.mt-3

    // Column 1: Upcoming Appointments 
    .col-lg-6
      // Upcoming Appointments Card
      .card.shadow-sm.mb-4
        .card-header.bg-primary.text-white
          h2.card-title.h4 Upcoming Appointments
        .card-body
          // Check if the appointments array was passed and has items
          if typeof appointments !== 'undefined' && appointments.length
            ul.list-group.list-group-flush
              // Iterate over each appointment fetched from the database
              each appt in appointments 
                li.list-group-item
                  .d-flex.justify-content-between.align-items-center
                    span
                      // Display date, service, and time slot clearly
                      strong Date:
                      | #{appt.preferredDate.toDateString()} 
                      strong.ms-3 Service:
                      | #{appt.service}
                      strong.ms-3 Time:
                      | #{appt.preferredTimeSlot}
                    
                    // ðŸŒŸ CRITICAL FIX: The Manage Button Link ðŸŒŸ
                    // Now links to /appointment/manage/ plus the unique MongoDB ID
                  
          else
            .alert.alert-info.mb-0(role='alert')
              | You have no upcoming appointments. Ready for a service? 
              a(href='/booking').alert-link Book Now.

    // Column 2: Vehicle Maintenance 
    .col-lg-6
      // Vehicle Maintenance Card
      .card.shadow-sm.mb-4
        .card-header.bg-success.text-white
          h2.card-title.h4 Vehicle Maintenance Status
        .card-body
          ul.list-group.list-group-flush
            // Oil Change 
            li.list-group-item
              .d-flex.justify-content-between.align-items-center
                strong Oil Change:
                span Next due in 
                  strong 3000 km
              .progress.mt-1
                progress.progress-bar.bg-warning(value="20", max="100") 
            
            // Battery Health 
            li.list-group-item
              .d-flex.justify-content-between.align-items-center
                strong Battery Health:
                span.badge.bg-success Good
              .progress.mt-1
                progress.progress-bar.bg-success(value="80", max="100")

            // Tire Wear 
            li.list-group-item
              .d-flex.justify-content-between.align-items-center
                strong Tire Wear:
                span.text-danger Check soon
              .progress.mt-1
                progress.progress-bar.bg-danger(value="60", max="100")
            
            .text-end.mt-3
              a(href='/services/preventive-maintenance').btn.btn-primary.btn-sm View Full Details
